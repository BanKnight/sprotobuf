!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.sprotobuf=t():e.sprotobuf=t()}(window,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t){e.exports={}},function(e,t,r){let n=e.exports=r(0);r(2),r(3),r(4),n.load=async function(e){return new Promise((t,r)=>{let i=new XMLHttpRequest;i.onreadystatechange=function(){if(4===i.readyState)if(0===i.status||200===i.status)try{let e=n.parse(i.responseText);t(e)}catch(e){r(e)}else r(Error("status "+i.status))},i.open("GET",e,!0),i.send(null)})}},function(e,t,r){const n=r(0),i=/[\s{}=;:[\],'"()<>]/g,o=/\s/,s=/^[a-zA-Z_][a-zA-Z_0-9]*$/,a=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,l=["double","float","uint8","int8","int16","uint16","int32","uint32","int64","uint64","bool","string","bytes"];function u(e,t){t=t||29989;let r=0;for(let t=0;t<e.length;++t)r=131*r+e.charCodeAt(t);return r%t+1}n.parse=function(e){const t={messages:new Map,services:new Map};let r,n=0,f=e.length,c=1;function d(e){return Error("illegal "+e+" (line "+c+")")}function p(){let t=void 0,r=void 0,s=void 0;do{if(n===f)return null;for(s=!1;o.test(t=e.charAt(n));)if("\n"===t&&++c,++n===f)return null;if("/"===e.charAt(n)){if(++n===f)throw d("comment");if("/"===e.charAt(n)){for(;"\n"!==e.charAt(++n);)if(n===f)return null;++c,++n,s=!0}else if("*"===(t=e.charAt(n))){do{if("\n"===t&&++c,++n===f)throw d("comment");r=t,t=e.charAt(n)}while("*"!==r||"/"!==t);++n,s=!0}}}while(s);let a=n;if(i.lastIndex=0,!i.test(e.charAt(a++)))for(;a<f&&!i.test(e.charAt(a));)++a;return e.substring(n,n=a)}function h(e){var t=p();if(t===e)return!0;throw d("token '"+t+"', '"+e+"' expected")}function m(e,t){switch(t){case"option":return function(e,t){if(!a.test(t=p()))throw d(t);let r=t;h("="),e[r]=parseInt(p()),h(";")}(e,t),!0;case"message":return function(e,t){if(!s.test(t=p()))throw d(t);const r={name:t,fields:new Map};h("{");for(;"}"!=(t=p());){if(m(r,t))continue;let e=_(t);if(e.name=p(),!s.test(e.name))throw d(e.name);if(h("="),e.id=parseInt(p()),h(";"),r.fields.get(e.name))throw d("same field name:"+e.name);if(r.fields.set(e.name,e),r.fields.get(e.id))throw d("same id:"+e.id);r.fields.set(e.id,e)}if(null!=e.messages.get(r.name))throw d(r.name);if(e.messages.set(r.name,r),void 0===r.id)for(r.id=u(r.name);null!=e.messages.get(r.id);)r.id++;e.messages.set(r.id,r)}(e,t),!0;case"service":return function(e,t){if(!s.test(t=p()))throw d(t);let r={name:t,methods:new Map};h("{");for(;"}"!=(t=p());)if(!m(r,t))switch(t){case"rpc":v(r,t);break;default:throw d(type.name)}if(null!=e.services.get(r.name))throw d(services.name);if(e.services.set(r.name,r),void 0===r.id)for(r.id=u(r.name);e.services.get(r.id)&&e.messages.get(r.id);)r.id++;if(e.services.get(r.id))throw d("same id:"+r.id);e.services.set(r.id,r)}(e,t),!0}return!1}for(;null!==(r=p());)if(!m(t,r))throw d(r);function _(e){switch(e){case"<":return function(e){let t=p();if(-1==l.indexOf(t))throw d("must be basic type:"+t);h(",");let r=p();if(!a.test(r))throw d(r);return h(">"),{key:t,val:r}}();case"[":return function(){let e=p();if(!a.test(e))throw d(e);return h("]"),{key:!1,val:e}}();default:return function(e){let t=e;if(!a.test(t))throw d(t);return{val:t}}(e)}}function v(e,t){let r=p();if(!s.test(r))throw d(r);let n={name:r,req:[],resp:void 0};for(h("(");")"!=(t=p());){if(","==t)continue;let e=_(t);if(e.name=p(),!s.test(e.name))throw d(e.name);n.req.push(e)}for(h("return"),h("("),")"!=(t=p())&&(n.resp=_(t),h(")")),h("{");"}"!=(t=p());)if(!m(n,t))throw d(t);if(e.methods.set(n.name,n),void 0===n.id)for(n.id=u(n.name);e.methods.get(n.id);)n.id++;if(e.methods.get(n.id))throw d("method id:"+n.id);e.methods.set(n.id,n)}for(let e of t.messages.values())for(let r of e.fields.values()){if("object"==typeof r.val)continue;if(l.indexOf(r.val)>-1)continue;let e=t.messages.get(r.val);if(null==e)throw Error("no such type:"+r.val);r.val=e}for(let e of t.services.values())for(let r of e.methods.values()){for(let e=0;e<r.req.length;++e){let n=r.req[e];if("object"==typeof n.val)continue;if(l.indexOf(n.val)>-1)continue;let i=t.messages.get(n.val);if(null==i)throw Error("no such type:"+n.val);n.val=i}if(null==r.resp)continue;if("object"==typeof r.resp.val)continue;if(l.indexOf(r.resp.val)>-1)continue;let e=t.messages.get(r.resp.val);if(null==e)throw Error("no such type:"+r.resp.val);r.resp.val=e}return t}},function(e,t,r){let n=r(0),i={};n.to_msg=function(e,t,r,n){let o=e.messages.get(r);if(null==o)throw Error("no such message:"+r);i.obj_to_msg(e,t,o,n)},n.to_rpc=function(e,t,r,...n){let o=r.split("."),s=o[0],a=o[1],l=e.services.get(s);if(null==l)throw Error("no such service:"+s);let u=l.methods.get(a);if(null==u)throw Error("no such method:"+r);if(n.length<u.req.length)throw Error("more params required:"+r);t.append_uint32(l.id<<16|u.id);let f=t.offset,c=0;t.append_uint8(0);for(let r=0;r<u.req.length;++r){let o=n[r];null!=o&&(t.append_uint8(r),i.write_type(e,t,u.req[r],o),c++)}t.replace_uint8(c,f)},n.to_resp=function(e,t,r,n){let o=r.split("."),s=o[0],a=o[1],l=e.services.get(s);if(null==l)throw Error("no such service:"+s);let u=l.methods.get(a);if(null==u)throw Error("no such method:"+r);u.resp&&i.write_type(e,t,u.resp,n)},n.to_error=function(e,t,r,n){t.append_uint16(r),t.append_string(n)},i.obj_to_msg=function(e,t,r,n){let o=t.offset;t.append_uint16(0);let s=0;for(let o in n){let a=n[o];if(null==a)continue;let l=r.fields.get(o);null!=l&&(t.append_uint8(l.id),i.write_type(e,t,l,a),s++)}t.replace_uint16(s,o)},i.write_type=function(e,t,r,n){if(void 0===r.key)i.write_val(e,t,r.val||r,n);else if(!1===r.key){t.append_uint16(n.length);for(let o of n)i.write_val(e,t,r.val,o)}else if(n instanceof Map){t.append_uint16(n.size);for(let[o,s]of n)i.write_val(e,t,r.key,o),i.write_type(e,t,r.val,s)}else{let o=t.offset,s=0;t.append_uint16(s);for(let o in n){let a=n[o];null!=a&&(i.write_val(e,t,r.key,o),i.write_type(e,t,r.val,a),s++)}t.replace_uint16(s,o)}},i.write_val=function(e,t,r,n){switch(r){case"double":case"float":case"uint8":case"int8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":t[`append_${r}`](n);break;case"bool":t.append_uint8(n?1:0);break;case"string":t.append_string(n);break;case"bytes":t.append_bytes(n);break;default:i.obj_to_msg(e,t,r,n)}}},function(e,t,r){let n=r(0),i={};n.from_msg=function(e,t,r){let n=e.messages.get(r);if(null==n)throw Error("no such message:"+r);return i.msg_to_obj(e,t,n)},n.from_rpc=function(e,t){let r=t.read_uint32(),n=r>>16,o=65535&r,s=e.services.get(n);if(null==s)throw Error("no such service:"+n);let a=s.methods.get(o);if(null==a)throw Error("no such method:"+a);let l={},u=t.read_uint8();for(let r=0;r<u;++r){let r=t.read_uint8(),n=a.req[r],o=i.read_type(e,t,n);l[n.name]=o}return{service:s.name,method:a.name,req:l}},n.from_resp=function(e,t,r){let n=r.split("."),o=n[0],s=n[1],a=e.services.get(o);if(null==a)throw Error("no such service:"+o);let l=a.methods.get(s);if(null==l)throw Error("no such method:"+r);if(null!=l.resp)return i.read_type(e,t,l.resp)},n.from_error=function(e,t){return[t.read_uint16(),t.read_string()]},i.msg_to_obj=function(e,t,r){let n={},o=t.read_uint16();for(let s=0;s<o;++s){let o=t.read_uint8(),s=r.fields.get(o);if(null==s)throw Error("no such field id:"+o);n[s.name]=i.read_type(e,t,s)}return n},i.read_type=function(e,t,r){if(void 0===r.key)return i.read_val(e,t,r.val||r);if(!1===r.key){let n=[],o=t.read_uint16();for(let s=0;s<o;++s)n.push(i.read_type(e,t,r.val));return n}let n=new Map,o=t.read_uint16();for(let s=0;s<o;++s){let o=i.read_val(e,t,r.key),s=i.read_type(e,t,r.val);n.set(o,s)}return n},i.read_val=function(e,t,r){let n;switch(r){case"double":case"float":case"uint8":case"int8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":n=t[`read_${r}`]();break;case"bool":n=1==t.read_uint8();break;case"string":n=t.read_string();break;case"bytes":n=t.read_bytes();break;default:n=i.msg_to_obj(e,t,r)}return n}}])});
//# sourceMappingURL=sprotobuf.min.js.map